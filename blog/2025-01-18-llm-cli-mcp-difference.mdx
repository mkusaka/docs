---
title: "LLMがCLIを直接使うのとMCP経由で使うのでは何が違うか、結論LLMが知ってるかどうかで使い分けるとよい"
date: 2025-01-18
description: "LLMがCLIを直接使うのとMCP経由で使うのでは何が違うか、MCPのメリットと使い分けについて"
categories: [tips]
tags: [llm, mcp, cli, claude, tools]
---

## まとめ

- LLMがCLIを直接使う場合とMCPを使う場合の使い分けは、LLMがそのツールを知っているかどうかで判断するとよい
- MCPはLLMが知らないツール（自前開発のcli、APIなど）に対して利用方法のpromptやschemaを定義できるので間違いを減らせる
- よく知られたCLIでも最新機能はLLMが知らないので、MCP経由で知らせることができる
- MCPはLLMの決定にプログラマティックに介入でき、サービス提供者側が制御を最適化できるのが革命的
- セキュリティ的にもLLMに勝手に叩かれたくないcliをプログラマティックに制御できる点がMCPのメリット
- ただしコンテキストが肥大化するとMCPの存在を忘れたりと不安定なところもあり改善の余地はある

## 詳細

### LLMが知っているツールの場合

git、ls、curl などよく知られたCLIコマンドは、LLMが使い方を熟知しているので直接Bashで実行させた方が効率的。わざわざMCPでラップする必要はない。

```bash
# LLMが知ってるコマンドは直接実行で問題ない
git status
ls -la
curl https://api.example.com
```

### LLMが知らないツールの場合

自前開発のスクリプトや社内APIなどは、MCPでツールの利用方法を定義することで：
- どのフィールドに何を入れるかのschemaが明確になる
- 使い方のpromptで誤用を防げる  
- 型安全性を確保できる

```typescript
// MCPでツールを定義
{
  name: "deploy-service",
  description: "社内のデプロイツール。環境とバージョンを指定してデプロイする",
  parameters: {
    environment: { type: "string", enum: ["dev", "staging", "prod"] },
    version: { type: "string", pattern: "^v\\d+\\.\\d+\\.\\d+$" }
  }
}
```

### MCPの本質的な価値

MCPの革命的な点は「サービス利用者側」ではなく「サービス提供者側」がLLMの振る舞いを制御できること。これにより：
- サービスごとに最適化された制御が可能
- セキュリティ的に危険なコマンドの実行を防げる
- 課金が発生するAPIの呼び出しを制限できる

```typescript
// MCPでセキュリティ制御
if (command.includes("rm -rf")) {
  throw new Error("危険なコマンドは実行できません");
}
```

### 現状の課題

コンテキストが長くなるとMCPツールの存在自体を忘れてしまうことがある。これは今後の改善点。

## 実用例

### よく知られたCLIの最新機能をMCPで補完

例えば、npmの最新機能である`npm query`はLLMがまだ知らない可能性がある。MCPで定義することで確実に使える。

```typescript
{
  name: "npm-query",
  description: "npm query を使って依存関係を検索する（npm v8.16.0以降）",
  parameters: {
    selector: { type: "string", description: "CSS-like selector for dependencies" }
  }
}
```

### 自前CLIの統合

社内で開発したCLIツールはLLMが知るはずもないので、MCPで定義することで自然に使えるようになる。

```typescript
{
  name: "internal-db-migrate",
  description: "社内DBマイグレーションツール",
  parameters: {
    direction: { enum: ["up", "down"] },
    steps: { type: "number", default: 1 }
  }
}
```

## 結論

「CLIでよくね？」となることも多いが、LLMが知らないツールや最新機能、セキュリティが重要な場面ではMCPの価値が発揮される。使い分けが重要。